
---
# Overview
Each feature will have tables to support it, beginning with the authentication tables, of which there were two. Going forward a brand new schema was created for Family Social. Currently **all** of the schema is defined in `@/features/auth/components/db/family-social-schema-tables.ts`. It made sense to put the (drizzle) schema definition in one place (in the `auth` folder). 

During development all schema is pushed to the Neon `family-social-dev` branch. Currently the production branch is empty. The original auth tables were still retained, to support the Auth.js template project. The `FAMILY_SOCIAL_DATABASE_URL` property is defined in the `@/.env.local` file.

# Family Social Schema
The ERD to support the login and family registration process is shown below (notes follow). 

![](./docs/new-schema.png)

- The tables shown above are color coded where the **blue tables** are related to the authentication process and the **yellow tables** related to the family registration process.
- The `user` table is referenced for the login process but as the `family_name` is required as a part of the login, a foreign key to retrieve the `family_name` in the `family` table was added to the `user` table. 
- The `email` address exists in several tables and was denormalized for convenience. It is generally unique, except in the `member` table. An email address could exists for a member if they belong to more than one family.
- To not embed notifications and other options, they've been separated out to the `member_option` table. 
  - It is the result of a M:M implementation between `member` and `option_reference` tables.
  - When a family member initially registers, all of the options will be inserted into the `member option` table. Thereafter, only if an option is checked or unchecked wlll the table be updated.
  - The member profile prototype dialog is shown below to provide a picture of the data the tables must support.

    ![](./docs/member-profile.png)

# Family Social Queries

The queries related to authentication reside in `@/features/auth/components/db` and have a `queries-` prefix. 
